<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DigiQuiz Admin Panel</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="admin-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Meta Tags -->
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="DigiQuiz Admin Panel - Secure Administrative Dashboard">
</head>
<body>
    <!-- Admin Loading Screen -->
    <div id="admin-loading" class="admin-loading">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Verifying admin credentials...</p>
        </div>
    </div>

    <!-- Admin Panel Container -->
    <div id="admin-panel" class="admin-panel" style="display: none;">
        
        <!-- Admin Header -->
        <header class="admin-header">
            <div class="admin-header-left">
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="admin-logo">
                    <i class="fas fa-shield-alt"></i>
                    <span>DigiQuiz Admin</span>
                </div>
            </div>
            
            <div class="admin-header-center">
                <div class="admin-search">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search admin panel..." id="admin-search">
                </div>
            </div>
            
            <div class="admin-header-right">
                <!-- Real-time Stats -->
                <div class="header-stats">
                    <div class="stat-item">
                        <span class="stat-label">Online Users</span>
                        <span class="stat-value" id="online-users">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Active Quizzes</span>
                        <span class="stat-value" id="active-quizzes">0</span>
                    </div>
                </div>
                
                <!-- Admin Profile -->
                <div class="admin-profile-dropdown">
                    <button class="admin-profile-btn" id="admin-profile-btn">
                        <div id="admin-info"></div>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="admin-dropdown-menu" id="admin-dropdown">
                        <a href="#profile" class="dropdown-item">
                            <i class="fas fa-user"></i> Profile Settings
                        </a>
                        <a href="#security" class="dropdown-item">
                            <i class="fas fa-lock"></i> Security
                        </a>
                        <a href="#logs" class="dropdown-item">
                            <i class="fas fa-history"></i> Activity Logs
                        </a>
                        <div class="dropdown-divider"></div>
                        <button onclick="adminAuth.adminLogout()" class="dropdown-item logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Admin Sidebar -->
        <nav class="admin-sidebar" id="admin-sidebar">
            <div class="sidebar-content">
                
                <!-- Dashboard -->
                <div class="menu-section">
                    <h3>Overview</h3>
                    <a href="#dashboard" class="menu-item active" id="menu-dashboard" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </div>

                <!-- Quiz Management -->
                <div class="menu-section">
                    <h3>Quiz Management</h3>
                    <a href="#quiz-management" class="menu-item" id="menu-quiz-management" data-section="quiz-management">
                        <i class="fas fa-question-circle"></i>
                        <span>Manage Quizzes</span>
                    </a>
                    <a href="#quiz-upload" class="menu-item" id="menu-quiz-upload" data-section="quiz-upload">
                        <i class="fas fa-upload"></i>
                        <span>Upload Quiz</span>
                    </a>
                    <a href="#categories" class="menu-item" id="menu-categories" data-section="categories">
                        <i class="fas fa-tags"></i>
                        <span>Categories</span>
                    </a>
                </div>

                <!-- User Management -->
                <div class="menu-section">
                    <h3>User Management</h3>
                    <a href="#user-management" class="menu-item" id="menu-user-management" data-section="user-management">
                        <i class="fas fa-users"></i>
                        <span>Manage Users</span>
                    </a>
                    <a href="#admin-management" class="menu-item" id="menu-admin-management" data-section="admin-management">
                        <i class="fas fa-user-shield"></i>
                        <span>Admin Users</span>
                    </a>
                </div>

                <!-- Analytics & Reports -->
                <div class="menu-section">
                    <h3>Analytics</h3>
                    <a href="#analytics" class="menu-item" id="menu-analytics" data-section="analytics">
                        <i class="fas fa-chart-bar"></i>
                        <span>Analytics</span>
                    </a>
                    <a href="#reports" class="menu-item" id="menu-reports" data-section="reports">
                        <i class="fas fa-file-alt"></i>
                        <span>Reports</span>
                    </a>
                </div>

                <!-- System -->
                <div class="menu-section">
                    <h3>System</h3>
                    <a href="#site-config" class="menu-item" id="menu-site-config" data-section="site-config">
                        <i class="fas fa-cogs"></i>
                        <span>Site Configuration</span>
                    </a>
                    <a href="#content-moderation" class="menu-item" id="menu-content-moderation" data-section="content-moderation">
                        <i class="fas fa-eye"></i>
                        <span>Content Moderation</span>
                    </a>
                    <a href="#data-export" class="menu-item" id="menu-data-export" data-section="data-export">
                        <i class="fas fa-download"></i>
                        <span>Data Export</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="admin-main" id="admin-main">
            
            <!-- Dashboard Section -->
            <section id="dashboard" class="admin-section active">
                <div class="section-header">
                    <h1>Admin Dashboard</h1>
                    <p>Welcome to the DigiQuiz Admin Panel. Monitor and manage your quiz platform.</p>
                </div>
                
                <!-- Quick Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-users">0</h3>
                            <p>Total Users</p>
                            <span class="stat-change positive" id="users-change">+0%</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-quizzes">0</h3>
                            <p>Total Quizzes</p>
                            <span class="stat-change positive" id="quizzes-change">+0%</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="quiz-attempts">0</h3>
                            <p>Quiz Attempts</p>
                            <span class="stat-change positive" id="attempts-change">+0%</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="avg-score">0%</h3>
                            <p>Average Score</p>
                            <span class="stat-change neutral" id="score-change">0%</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h2>Quick Actions</h2>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="switchSection('quiz-upload')">
                            <i class="fas fa-plus"></i>
                            Upload New Quiz
                        </button>
                        <button class="action-btn secondary" onclick="switchSection('user-management')">
                            <i class="fas fa-users-cog"></i>
                            Manage Users
                        </button>
                        <button class="action-btn tertiary" onclick="switchSection('analytics')">
                            <i class="fas fa-analytics"></i>
                            View Analytics
                        </button>
                        <button class="action-btn quaternary" onclick="exportAllData()">
                            <i class="fas fa-download"></i>
                            Export Data
                        </button>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="recent-activities">
                    <h2>Recent Activities</h2>
                    <div class="activity-list" id="recent-activities">
                        <!-- Activities will be loaded dynamically -->
                    </div>
                </div>

                <!-- Real-time Charts -->
                <div class="dashboard-charts">
                    <div class="chart-container">
                        <h3>User Registrations (Last 30 Days)</h3>
                        <canvas id="users-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Quiz Completion Rate</h3>
                        <canvas id="completion-chart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Other sections will be added in subsequent steps -->
            <!-- Placeholder sections for now -->
            <section id="quiz-management" class="admin-section">
                <h1>Quiz Management</h1>
                <p>Manage existing quizzes - Coming in next step</p>
            </section>

            <section id="quiz-upload" class="admin-section">
                <h1>Quiz Upload</h1>
                <p>Upload new quizzes - Coming in next step</p>
            </section>

            <section id="user-management" class="admin-section">
                <h1>User Management</h1>
                <p>Manage users - Coming in next step</p>
            </section>

            <section id="analytics" class="admin-section">
                <h1>Analytics</h1>
                <p>View analytics - Coming in next step</p>
            </section>

        </main>
    </div>

    <!-- Firebase Configuration -->
    

<script src="firebase-config.js?v=2"></script>
<script src="admin-auth.js?v=2"></script>
<script src="admin-dashboard.js?v=2"></script>



    
    <script>
        // Initialize admin panel once Firebase is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Check for admin authentication
            firebase.auth().onAuthStateChanged((user) => {
                const loading = document.getElementById('admin-loading');
                const panel = document.getElementById('admin-panel');
                
                if (user) {
                    // User is signed in, check admin privileges
                    user.getIdTokenResult().then((idTokenResult) => {
                        const claims = idTokenResult.claims;
                        if (claims.admin || claims.superAdmin || claims.moderator) {
                            // User has admin privileges
                            loading.style.display = 'none';
                            panel.style.display = 'flex';
                            
                            // Initialize admin dashboard
                            if (window.adminDashboard) {
                                window.adminDashboard.init();
                            }
                        } else {
                            // User doesn't have admin privileges
                            window.location.href = '/index.html?error=access_denied';
                        }
                    }).catch(() => {
                        window.location.href = '/index.html?error=auth_error';
                    });
                } else {
                    // User is not signed in
                    window.location.href = '/index.html?redirect=admin';
                }
            });
        });
    </script>
</body>
</html>
